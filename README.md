
# CanSat Ground Station (Ground-Station)

A compact ground-station utility for interacting with a CanSat payload over a serial link. This repository contains a small interactive TUI ground station (`ground_station.py`) and a simple data generator/simulator (`data_simulator.py`) that produces a pressure profile CSV suitable for testing.

## Repository contents

- `ground_station.py`  — terminal ground station app (TUI). Connects to serial, decodes incoming packets, and can send commands.
- `data_simulator.py`  — creates `cansat_pressure_profile.csv` (sample pressure vs time) for testing.
- `cansat_pressure_profile.csv` — generated by the simulator (if present).
- `serial_log.csv`     — example/placeholder for logs saved from the UI.

## Requirements

- Python 3.8+
- Packages:
	- pyserial
	- prompt_toolkit

You can install the Python dependencies with pip:

```powershell
python -m pip install pyserial prompt_toolkit
```

If you prefer to isolate dependencies, use a virtual environment:

```powershell
python -m venv .venv; .\.venv\Scripts\Activate.ps1; python -m pip install --upgrade pip; python -m pip install pyserial prompt_toolkit
```

## Quick start

1. (Optional) Generate a simulated pressure profile if you want to test without hardware:

```powershell
python data_simulator.py
```

This creates `cansat_pressure_profile.csv` with two minutes of 1 Hz pressure samples.

2. Start the ground station (edit the COM port in the script if required; default in `ground_station.py` is `COM10`):

```powershell
python ground_station.py
```

3. Use the input prompt in the TUI to send commands. Press F2 to toggle between raw hex and decoded info displays.

## Example usage

```powershell
> enter-sim
Entered simulation mode
> launch
Sent launch command
> send-sim
Started simulated pressure transmission...
```

For example, type `enter-sim` and press Enter to send a command to enter simulation mode. Then type `launch` to send a launch command, and `send-sim` to start sending pressure samples from the CSV file.

## Available commands (typed at prompt)

- `launch` — send a launch command packet (payload `0x01`).
- `enter-sim` — instructs the system to enter simulation mode (payload `0x03`).
- `send-sim` — reads `cansat_pressure_profile.csv` and sends each pressure value as a float (1 Hz) prefixed by command byte `0x02`.
- `pressure <value>` — send an explicit pressure float value (e.g., `pressure 101325`).
- `save-log [file]` — save the current raw output to a CSV file (`serial_log.csv` by default).
- `help` — show command list.
- `exit` — close serial and quit the app.

The application will append user-visible messages to both the Raw and Decoded panes to confirm actions.

## Packet framing / protocol (as implemented)

- Start byte: 0xFF
- Length byte: number of payload bytes
- Payload: variable; e.g. first byte may be a command ID (`0x01` = launch, `0x02` = pressure float, `0x03` = enter-sim)
- Checksum: XOR of payload bytes (single byte)
- End byte: 0x0A

Examples inside `ground_station.py`:
- Sending a pressure float: the code does `gs.write_line(b'\x02' + struct.pack('<f', value))` which sends command byte 0x02 followed by a little-endian float.

Incoming telemetry decoding in `ground_station.py` expects a short packet where specific bytes map to:
- packet_count = byte 1
- mode = byte 2 (mapped to `MODE_SIMULATION` / `MODE_FLIGHT`)
- state = byte 3 (mapped to `LAUNCH_PAD`, `ASCENT`, `DESCENT`, `PROBE_RELEASE`, `LANDED`)
- altitude and pressure are read as little-endian floats at the following offsets in the payload. See `decode_line()` in `ground_station.py` for exact parsing.

## CSV format used by the simulator

- Header: `time_s,pressure_Pa`
- Rows: integer seconds and pressure in pascals, e.g. `0,101325.00`.

`ground_station.py` reads this CSV line-by-line (skipping the header) when `send-sim` is issued and sends pressure payloads at 1 Hz.

## Notes for developers

- Serial port: the script opens `COM10` by default. Change the `SerialReader('COM10', 9600)` line to the appropriate port for your system.
- The TUI uses `prompt_toolkit.Application(..., full_screen=True)`. If you prefer a non-fullscreen run for debugging, modify that call.
- Error handling is minimal by design—improve robustness (timeouts, reconnection, stricter framing checks) for production use.

## Troubleshooting

- If you see no incoming data, verify serial wiring / port and baud rate. Use Device Manager on Windows to confirm the COM port (set to 10 by default).
- If `cansat_pressure_profile.csv` is not found when running `send-sim`, run `python data_simulator.py` or ensure the CSV is in the current working directory.
